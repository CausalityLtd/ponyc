task:
  container:
    image: ponylang/ponyc-ci:ubuntu
    cpu: 8
    memory: 24

  name: "linux gnu release builder"

  clone_script: |
    if [ -n "$CIRRUS_TAG" ]
    then
      echo "cloning for tag $CIRRUS_TAG"
      git clone --depth 1 --branch "$CIRRUS_TAG" --recurse-submodules https://github.com/ponylang/ponyc.git
    elif [ -n "$CIRRUS_BRANCH" ]
    then
      echo "cloning for branch $CIRRUS_BRANCH"
      git clone --depth 1 --branch "$CIRRUS_BRANCH" --recurse-submodules https://github.com/ponylang/ponyc.git
    fi

  test_script:
    - cd ponyc
    - make -f Makefile-lib-llvm config=release default_pic=true arch=x86-64 use=llvm_link_static -j8
